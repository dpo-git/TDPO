<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>N7 ‚Äî –§–∏–Ω–∞–ª –∑–º–µ–π–∫–∏: –≤–∞—à–µ —Å–µ—Ä–¥–µ—á–∫–æ</title>

<link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&family=Roboto+Mono:wght@400;500&display=swap" rel="stylesheet">

<!-- Pyodide -->
<script src="https://cdn.jsdelivr.net/pyodide/v0.24.1/full/pyodide.js"></script>

<!-- MathJax (–Ω–∞ —Å–ª—É—á–∞–π —Ñ–æ—Ä–º—É–ª, —Å—Ç–∏–ª—å –∫–∞–∫ —Ä–∞–Ω—å—à–µ) -->
<script>
window.MathJax = { tex: {inlineMath: [['$', '$'], ['\\(', '\\)']]}, svg: {fontCache: 'global'} };
</script>
<script async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-svg.js"></script>

<style>
:root {
  --bg:#fff;
  --fg:#202124;
  --muted:#5f6368;
  --border:#e0e3e7;
  --accent:#1a73e8;
  --code-bg:#f8f9fa;
  --out-bg:#0b1020;
  --out-fg:#e5e7eb;
}

/* –±–∞–∑–æ–≤–∞—è —Ä–∞—Å–∫–ª–∞–¥–∫–∞ */
*{box-sizing:border-box}
html,body{margin:0;padding:0;background:var(--bg);color:var(--fg)}
body{font-family:'Roboto',system-ui,-apple-system,Segoe UI,Arial,sans-serif}
main{max-width:1024px;margin:0 auto;padding:24px 16px 64px}
header.page-title h1{margin:0 0 8px;font-size:28px;font-weight:700;line-height:1.25}

.header-actions{margin-top:8px;}
.header-actions .btn{
  appearance:none;
  padding:8px 14px;
  font-size:14px;
  border-radius:8px;
  cursor:pointer;
  line-height:1.2;
  border:1px solid var(--accent);
  background:var(--accent);
  color:#fff;
}

/* —è—á–µ–π–∫–∏ –∏ —Ä–∞–∑–¥–µ–ª–∏—Ç–µ–ª–∏ */
.cell{margin:16px 0}
hr.sep{margin:24px 0;border:0;border-top:1px solid var(--border)}

/* markdown-–±–ª–æ–∫–∏ */
.cell.md .md{font-size:16px;line-height:1.65}
.cell.md .md h1,.cell.md .md h2,.cell.md .md h3,.cell.md .md h4{margin:1.2em 0 .6em;font-weight:700}
.cell.md .md h1{font-size:1.4em}
.cell.md .md h2{font-size:1.3em}
.cell.md .md h3{font-size:1.2em}
.cell.md .md code{
  background:#f1f3f4;
  padding:2px 4px;
  border-radius:4px;
  font-family:'Roboto Mono',ui-monospace,Menlo,Consolas,monospace
}
.cell.md .md pre code{
  background:var(--code-bg);
  display:block;
  padding:10px;
  border:1px solid var(--border);
  border-radius:8px;
  white-space:pre-wrap
}
.cell.md .md ul,.cell.md .md ol{margin:.25em 0 1em;padding-left:1.4em}
.cell.md .md li{margin:.25em 0}
.cell.md .md li>p{margin:0}

.cell.md .md blockquote.md-hint{
  margin:10px 0;
  padding:10px 12px;
  border-left:4px solid #8b5cf6;
  background:#f5f3ff;
  border-radius:8px;
}
.cell.md .md blockquote.md-hint p{margin:0}

/* "–∫–æ–¥–æ–≤–∞—è" —è—á–µ–π–∫–∞, –Ω–æ —Ç–µ–ø–µ—Ä—å —ç—Ç–æ —Ñ–æ—Ä–º–∞ */
.cell.code .editor-wrap{
  border:1px solid var(--border);
  border-radius:12px;
  background:#fff;
  box-shadow:0 1px 2px rgba(0,0,0,.05);
  padding-bottom:0;
  resize:vertical;
  overflow:hidden;
}
.cell-header{
  display:flex;
  align-items:center;
  justify-content:space-between;
  gap:12px;
  padding:8px 12px;
  background:#f8fbff;
  border-bottom:1px solid var(--border);
  flex-wrap:wrap;
}
.badge{color:var(--muted);font-size:12px;white-space:nowrap}
.actions{display:flex;flex-wrap:wrap;gap:6px}
.actions .btn{
  appearance:none;
  padding:6px 10px;
  font-size:13px;
  border-radius:8px;
  cursor:pointer;
  border:1px solid var(--border);
  background:#fff;
  color:#202124;
  line-height:1.2;
}
.actions .btn.run{
  border:1px solid var(--accent);
  background:var(--accent);
  color:#fff;
}
.actions .btn.clear,
.actions .btn.download{
  margin-left:6px;
}

/* —Ñ–æ—Ä–º–∞ —Å –≤–≤–æ–¥–æ–º —á–∏—Å–µ–ª a_1 ... a_6 */
.form-area{
  background:var(--code-bg);
  border-bottom:1px solid var(--border);
  font-family:'Roboto Mono',ui-monospace,Menlo,Consolas,monospace;
  font-size:14px;
  line-height:1.45;
  padding:12px;
}
.form-grid{
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(min(140px,100%),1fr));
  gap:12px;
  margin-bottom:12px;
}
.form-field{
  display:flex;
  flex-direction:column;
  font-family:'Roboto Mono',ui-monospace,Menlo,Consolas,monospace;
  font-size:14px;
  line-height:1.45;
}
.form-field label{
  font-weight:500;
  color:#202124;
  margin-bottom:4px;
  display:flex;
  align-items:center;
  justify-content:space-between;
  flex-wrap:wrap;
  gap:4px;
}
.form-field code{
  background:#f1f3f4;
  padding:2px 4px;
  border-radius:4px;
}
.form-field input{
  appearance:none;
  border:1px solid var(--border);
  border-radius:6px;
  background:#fff;
  padding:6px 8px;
  font-family:'Roboto Mono',ui-monospace,Menlo,Consolas,monospace;
  font-size:14px;
  line-height:1.4;
  width:100%;
}

.small-hint{
  margin:0;
  color:var(--muted);
  font-size:13px;
  line-height:1.4;
  font-family:'Roboto',system-ui,-apple-system,Segoe UI,Arial,sans-serif;
}

/* –≤—ã–≤–æ–¥ */
.output{
  background:var(--out-bg);
  color:var(--out-fg);
  padding:12px;
  min-height:24px;
  font-family:'Roboto Mono',ui-monospace,Menlo,Consolas,monospace;
  font-size:14px;
  line-height:1.45;
  border-bottom-left-radius:12px;
  border-bottom-right-radius:12px;
}
.output pre{margin:0;white-space:pre-wrap}
.output img{
  display:block;
  margin:8px 0;
  max-width:100%;
  height:auto;
  border:1px solid #222;
  border-radius:6px;
  background:#fff;
}

footer.note{
  color:var(--muted);
  font-size:13px;
  margin-top:40px
}
</style>
</head>
<body>
<main>
  <header class="page-title">
    <h1>N7 ‚Äî –§–∏–Ω–∞–ª –∑–º–µ–π–∫–∏: –≤–∞—à–µ —Å–µ—Ä–¥–µ—á–∫–æ</h1>
    <div class="header-actions">
      <button class="btn" onclick="saveAnswersTxt()">üíæ –°–∫–∞—á–∞—Ç—å –≤–≤–µ–¥—ë–Ω–Ω—ã–µ —á–∏—Å–ª–∞</button>
    </div>
  </header>

  <section class="cell md"><div class="md">
    <h1># –ß—Ç–æ –º—ã –¥–µ–ª–∞–µ–º –≤ —Å–µ–¥—å–º–æ–º –∑–∞–¥–∞–Ω–∏–∏?</h1>

    <p>–ü–æ–∑–¥—Ä–∞–≤–ª—è–µ–º üéâ –í—ã –¥–æ—à–ª–∏ –¥–æ –∫–æ–Ω—Ü–∞ –Ω–∞—à–µ–π ¬´–∑–º–µ–π–∫–∏¬ª.
    –£ –≤–∞—Å –µ—Å—Ç—å —à–µ—Å—Ç—å —á–∏—Å–µ–ª <code>a_1</code>, <code>a_2</code>, <code>a_3</code>,
    <code>a_4</code>, <code>a_5</code>, <code>a_6</code>,
    –ø–æ–ª—É—á–µ–Ω–Ω—ã–µ –≤ –∑–∞–¥–∞–Ω–∏—è—Ö ‚Ññ1-‚Ññ6.</p>

    <p>–°–µ–π—á–∞—Å –≤–∞–º –Ω–µ –Ω—É–∂–Ω–æ –ø–∏—Å–∞—Ç—å –∫–æ–¥.
    –ù—É–∂–Ω–æ —Ç–æ–ª—å–∫–æ –≤–≤–µ—Å—Ç–∏ —ç—Ç–∏ —à–µ—Å—Ç—å —á–∏—Å–µ–ª –≤ –ø–æ–ª—è –Ω–∏–∂–µ –∏ –Ω–∞–∂–∞—Ç—å –∫–Ω–æ–ø–∫—É
    ¬´–ü–æ—Å—Ç—Ä–æ–∏—Ç—å —Å–µ—Ä–¥–µ—á–∫–æ¬ª.</p>

    <p>–ß—Ç–æ –ø—Ä–æ–∏–∑–æ–π–¥—ë—Ç –¥–∞–ª—å—à–µ:</p>
    <ul>
      <li>–º—ã —Å—Ä–∞–≤–Ω–∏–º –≤–∞—à–∏ –æ—Ç–≤–µ—Ç—ã —Å ¬´–∏–¥–µ–∞–ª—å–Ω—ã–º–∏¬ª,</li>
      <li>–æ—Ü–µ–Ω–∏–º, –Ω–∞—Å–∫–æ–ª—å–∫–æ –±–ª–∏–∑–∫–∏ –≤–∞—à–∏ —Ä–µ—à–µ–Ω–∏—è,</li>
      <li>–ø–æ—Å—Ç—Ä–æ–∏–º –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω–æ–µ —Å–µ—Ä–¥–µ—á–∫–æ ‚ù§Ô∏è.</li>
    </ul>

    <blockquote class="md-hint">
      <p>
      –°–µ—Ä–¥–µ—á–∫–æ –ø–æ—Å—Ç—Ä–æ–∏—Ç—Å—è –≤ –ª—é–±–æ–º —Å–ª—É—á–∞–µ.
      –ß–µ–º –±–ª–∏–∂–µ –≤–∞—à–∏ –∑–Ω–∞—á–µ–Ω–∏—è –∫ ¬´–∏–¥–µ–∞–ª—å–Ω—ã–º¬ª, —Ç–µ–º —Ä–æ–≤–Ω–µ–µ –∏ ¬´—Å–ø–æ–∫–æ–π–Ω–µ–µ¬ª –ø–æ–ª—É—á–∞–µ—Ç—Å—è —Å–µ—Ä–¥–µ—á–∫–æ.
      –ß–µ–º –±–æ–ª—å—à–µ —Ä–∞–∑–±—Ä–æ—Å, —Ç–µ–º —Å–∏–ª—å–Ω–µ–µ –¥—Ä–æ–∂–∏—Ç –∏ —Å–º–µ—â–∞–µ—Ç—Å—è ¬´–ª–∏–Ω–∏—è —Å–µ—Ä–¥–µ—á–∫–∞¬ª.</p>
    </blockquote>

  </div></section>

  <hr class="sep"/>

  <section class="cell code">
    <div class="editor-wrap">
      <div class="cell-header">
        <span class="badge">In&nbsp;[1]</span>
        <div class="actions">
          <button class="btn run" onclick="runFinal('out1')">‚ñ∂ –ü–æ—Å—Ç—Ä–æ–∏—Ç—å —Å–µ—Ä–¥–µ—á–∫–æ</button>
          <button class="btn clear" onclick="clearOut('out1')">–û—á–∏—Å—Ç–∏—Ç—å –≤—ã–≤–æ–¥</button>
          <button class="btn download" onclick="saveOutputTxt('out1','–§–∏–Ω–∞–ª.txt')">–°–∫–∞—á–∞—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç</button>
        </div>
      </div>

      <div class="form-area">
        <div class="form-grid">
          <div class="form-field">
            <label for="a1"><code>a_1</code></label>
            <input id="a1" type="text" placeholder="–Ω–∞–ø—Ä–∏–º–µ—Ä 7.8474">
          </div>
          <div class="form-field">
            <label for="a2"><code>a_2</code></label>
            <input id="a2" type="text" placeholder="–Ω–∞–ø—Ä–∏–º–µ—Ä 9.0984">
          </div>
          <div class="form-field">
            <label for="a3"><code>a_3</code></label>
            <input id="a3" type="text" placeholder="–Ω–∞–ø—Ä–∏–º–µ—Ä 3.2075">
          </div>
          <div class="form-field">
            <label for="a4"><code>a_4</code></label>
            <input id="a4" type="text" placeholder="–Ω–∞–ø—Ä–∏–º–µ—Ä 1.9875">
          </div>
          <div class="form-field">
            <label for="a5"><code>a_5</code></label>
            <input id="a5" type="text" placeholder="–Ω–∞–ø—Ä–∏–º–µ—Ä 23.0592">
          </div>
          <div class="form-field">
            <label for="a6"><code>a_6</code></label>
            <input id="a6" type="text" placeholder="–Ω–∞–ø—Ä–∏–º–µ—Ä 5.4987">
          </div>
        </div>

        <p class="small-hint">
          –ü–æ–¥—Å–∫–∞–∑–∫–∞: –≤–≤–æ–¥–∏—Ç–µ –≤–∞—à–∏ —á–∏—Å–ª–∞ —Å–æ –≤—Å–µ–º–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–º–∏ –∑–Ω–∞–∫–∞–º–∏ –ø–æ—Å–ª–µ –∑–∞–ø—è—Ç–æ–π.
          –ï—Å–ª–∏ —É –í—ã –≤ –∫–∞—á–µ—Å—Ç–≤–µ —Ä–∞–∑–¥–µ–ª–∏—Ç–µ–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª–∏ –∑–∞–ø—è—Ç—É—é, –∑–∞–º–µ–Ω–∏—Ç–µ –µ—ë –Ω–∞ —Ç–æ—á–∫—É (–Ω–∞–ø—Ä–∏–º–µ—Ä ¬´3,9587¬ª ‚Üí ¬´3.9587¬ª).
        </p>
      </div>

      <div id="out1" class="output"></div>
    </div>
  </section>

  <hr class="sep"/>

<script>
let pyReadyPromise = null;

// –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∞ Pyodide
async function getPy(){
  if(!pyReadyPromise){
    pyReadyPromise = (async()=>{
      const pyodide = await loadPyodide();
      try{
        await pyodide.loadPackage(['numpy','matplotlib']);
      }catch(e){
        console.warn('–ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–¥–≥—Ä—É–∑–∏—Ç—å –ø–∞–∫–µ—Ç—ã:', e);
      }
      return pyodide;
    })();
  }
  return pyReadyPromise;
}

// –æ—á–∏—Å—Ç–∏—Ç—å –≤—ã–≤–æ–¥
function clearOut(outId){
  const outEl = document.getElementById(outId);
  if(outEl){ outEl.innerHTML = ""; }
}

// —Å–∫–∞—á–∞—Ç—å –≤—ã–≤–æ–¥ (–∏—Ç–æ–≥ –∏ —Å–µ—Ä–¥–µ—á–∫–æ)
function saveOutputTxt(outId, filename='–§–∏–Ω–∞–ª.txt'){
  const outEl = document.getElementById(outId);
  const textContent = outEl ? outEl.innerText : "";
  const blob = new Blob([textContent],{type:'text/plain;charset=utf-8'});
  const a = document.createElement('a');
  a.href = URL.createObjectURL(blob);
  a.download = filename;
  a.click();
  URL.revokeObjectURL(a.href);
}

// —Å–∫–∞—á–∞—Ç—å –≤–≤–µ–¥—ë–Ω–Ω—ã–µ —á–∏—Å–ª–∞
function saveAnswersTxt(){
  const vals = collectUserValues();
  const txt =
    "a_1 = " + vals.a1 + "\n" +
    "a_2 = " + vals.a2 + "\n" +
    "a_3 = " + vals.a3 + "\n" +
    "a_4 = " + vals.a4 + "\n" +
    "a_5 = " + vals.a5 + "\n" +
    "a_6 = " + vals.a6 + "\n";
  const blob = new Blob([txt],{type:'text/plain;charset=utf-8'});
  const a   = document.createElement('a');
  a.href    = URL.createObjectURL(blob);
  a.download= '–í–∞—à–∏_—á–∏—Å–ª–∞.txt';
  a.click();
  URL.revokeObjectURL(a.href);
}

// —É—Ç–∏–ª–∏—Ç–∞: —á–∏—Ç–∞–µ–º –ø–æ–ª—è –≤–≤–æ–¥–∞ –∏ –∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ–º –≤ —á–∏—Å–ª–∞
function getVal(id){
  const raw = document.getElementById(id).value.trim().replace(',', '.');
  const num = parseFloat(raw);
  return num;
}
function collectUserValues(){
  return {
    a1: getVal('a1'),
    a2: getVal('a2'),
    a3: getVal('a3'),
    a4: getVal('a4'),
    a5: getVal('a5'),
    a6: getVal('a6'),
  };
}

// –∑–∞–ø—É—Å–∫ –≤—ã—á–∏—Å–ª–µ–Ω–∏—è —Å–µ—Ä–¥–µ—á–∫–∞
async function runFinal(outId){
  const outEl = document.getElementById(outId);
  outEl.innerHTML = "<span style='opacity:.85'>‚è≥ –ü–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ‚Ä¶</span>";

  // —Å–æ–±—Ä–∞–ª–∏ –∑–Ω–∞—á–µ–Ω–∏—è
  const vals = collectUserValues();
  const arrVals = [vals.a1, vals.a2, vals.a3, vals.a4, vals.a5, vals.a6];
  // –ø—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –≤–∞–ª–∏–¥–Ω–æ—Å—Ç—å
  for (let v of arrVals){
    if (Number.isNaN(v)){
      outEl.innerHTML = "<pre style='color:#ff6b6b'>–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ –≤—Å–µ —à–µ—Å—Ç—å —á–∏—Å–µ–ª (a_1 ... a_6)</pre>";
      return;
    }
  }

  const pyodide = await getPy();

  // –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∞ stdout/stderr + matplotlib backend
  const setup = `
import sys, io
buf_out, buf_err = io.StringIO(), io.StringIO()

class _W:
    def __init__(self,b): self.b=b
    def write(self,s): self.b.write(s)
    def flush(self): pass

sys.stdout = _W(buf_out)
sys.stderr = _W(buf_err)

import matplotlib
matplotlib.use('module://matplotlib.backends.backend_agg')
import matplotlib.pyplot as plt
`;

  try {
    await pyodide.runPythonAsync(setup);

    // —Ñ–æ—Ä–º–∏—Ä—É–µ–º –ø–∏—Ç–æ–Ω–æ–≤—Å–∫–∏–π –∫–æ–¥ —Å –ø–æ–¥—Å—Ç–∞–Ω–æ–≤–∫–æ–π –∑–Ω–∞—á–µ–Ω–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    const userCode = `
import numpy as np
import matplotlib.pyplot as plt

# –ó–Ω–∞—á–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:
a_1 = ${vals.a1}
a_2 = ${vals.a2}
a_3 = ${vals.a3}
a_4 = ${vals.a4}
a_5 = ${vals.a5}
a_6 = ${vals.a6}

# –≠—Ç–∞–ª–æ–Ω–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è (–∑–∞–¥–∞–Ω–Ω–∞—è "–∏–¥–µ–∞–ª—å–Ω–∞—è –∑–º–µ–π–∫–∞"):
A_TRUE = {
    "a_1": 1.6140,
    "a_2": 0.1480,
    "a_3": 1.1446,
    "a_4": 2.8472,
    "a_5": 48.5000,
    "a_6": 2.5872,
}

A_USER = {
    "a_1": a_1,
    "a_2": a_2,
    "a_3": a_3,
    "a_4": a_4,
    "a_5": a_5,
    "a_6": a_6,
}

# 1. –°—É–º–º–∞—Ä–Ω–∞—è –∞–±—Å–æ–ª—é—Ç–Ω–∞—è –æ—à–∏–±–∫–∞
diffs = []
for k in A_TRUE:
    diffs.append(abs(A_USER[k] - A_TRUE[k]))
total_error = sum(diffs)

# 2. –ü–µ—Ä–µ–≤–æ–¥–∏–º –æ—à–∏–±–∫—É –≤ –ø—Ä–æ—Ü–µ–Ω—Ç —Å–æ–≤–ø–∞–¥–µ–Ω–∏—è
score_raw = 100.0 - 30.0 * total_error
score = max(0.0, min(100.0, score_raw))

# 3. –ü–∞—Ä–∞–º–µ—Ç—Ä—ã —Å–µ—Ä–¥–µ—á–∫–∞
#    –ß–µ–º –±–æ–ª—å—à–µ –æ—à–∏–±–∫–∞ -> —Ç–µ–º –±–æ–ª—å—à–µ —à—É–º (—Å–µ—Ä–¥—Ü–µ –¥—Ä–æ–∂–∏—Ç)
noise_amp = min(0.5, 0.05 * total_error)

#    –°–¥–≤–∏–≥: –∑–∞–≤–∏—Å–∏—Ç –æ—Ç —Å–∞–º–∏—Ö –≤–∞—à–∏—Ö —á–∏—Å–µ–ª
shift_x = (a_1 - a_3) * 0.2
shift_y = (a_4 - a_6) * 0.2

#    –ú–∞—Å—à—Ç–∞–±: –∑–∞–≤–∏—Å–∏—Ç –æ—Ç a_5, —á—Ç–æ–±—ã —É –≤—Å–µ—Ö –±—ã–ª–∞ –ª–∏—á–Ω–∞—è —Ñ–æ—Ä–º–∞
base_scale = 0.1
scale = base_scale * (1 + a_5/100.0 * 0.05)

# 4. –°—Ç—Ä–æ–∏–º –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã —Å–µ—Ä–¥–µ—á–∫–∞ (–ø–∞—Ä–∞–º–µ—Ç—Ä–∏—á–µ—Å–∫–∞—è –∫—Ä–∏–≤–∞—è)
t = np.linspace(0, 2*np.pi, 400)

x0 = 16 * (np.sin(t)**3)
y0 = 13*np.cos(t) - 5*np.cos(2*t) - 2*np.cos(3*t) - np.cos(4*t)

# –ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º
x_scaled = scale * x0
y_scaled = scale * y0

# –î–æ–±–∞–≤–ª—è–µ–º —à—É–º (–µ—Å–ª–∏ total_error > 0)
rng = np.random.default_rng(42)  # —Ñ–∏–∫—Å–∏—Ä—É–µ–º, —á—Ç–æ–±—ã –∫–∞—Ä—Ç–∏–Ω–∫–∞ –±—ã–ª–∞ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–æ–¥–∏–º–æ–π
x_noisy = x_scaled + noise_amp * rng.normal(size=t.shape)
y_noisy = y_scaled + noise_amp * rng.normal(size=t.shape)

# –î–æ–±–∞–≤–ª—è–µ–º —Å–¥–≤–∏–≥
x_final = x_noisy + shift_x
y_final = y_noisy + shift_y

# 5. –†–∏—Å—É–µ–º —Å–µ—Ä–¥–µ—á–∫–æ
plt.figure(figsize=(4,4))
plt.plot(x_final, y_final, lw=2, color='red')
plt.axis('equal')
plt.axis('off')
plt.title("–í–∞—à–µ —Å–µ—Ä–¥–µ—á–∫–æ ‚ù§Ô∏è", pad=10)

# 6. –ü–µ—á–∞—Ç–∞–µ–º —Ç–µ–∫—Å—Ç–æ–≤—ã–π –∏—Ç–æ–≥
print("–°–æ–≤–ø–∞–¥–µ–Ω–∏–µ —Å —ç—Ç–∞–ª–æ–Ω–æ–º =", f"{score:.2f}%", "(—á–µ–º –±–ª–∏–∂–µ –∫ 100%, —Ç–µ–º –∞–∫–∫—É—Ä–∞—Ç–Ω–µ–µ)")
print("–°–ø–∞—Å–∏–±–æ, –≤—ã –¥–æ—à–ª–∏ –¥–æ –∫–æ–Ω—Ü–∞ –º–æ–¥—É–ª—è!")
`;

    await pyodide.runPythonAsync(userCode);

    // —Ç–µ–ø–µ—Ä—å —Å–æ–±–∏—Ä–∞–µ–º stdout/stderr + –∫–∞—Ä—Ç–∏–Ω–∫–∏
    const [stdoutText, stderrText, images] = await pyodide.runPythonAsync(`
import base64, io
from matplotlib import pyplot as plt
import matplotlib

outs = buf_out.getvalue()
errs = buf_err.getvalue()
imgs = []

for f in list(matplotlib._pylab_helpers.Gcf.get_all_fig_managers()):
    b = io.BytesIO()
    f.canvas.figure.savefig(b, format='png', dpi=120, bbox_inches='tight')
    imgs.append(base64.b64encode(b.getvalue()).decode())

plt.close('all')
outs, errs, imgs
`);

    // –≤—ã–≤–æ–¥–∏–º –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É
    outEl.innerHTML = "";
    if(stdoutText && stdoutText.trim()){
      const pre = document.createElement('pre');
      pre.textContent = stdoutText;
      outEl.appendChild(pre);
    }

    if(images && images.length){
      for(const b64 of images){
        const img = document.createElement('img');
        img.src = 'data:image/png;base64,'+b64;
        outEl.appendChild(img);
      }
    }

    if(stderrText && stderrText.trim()){
      const preErr = document.createElement('pre');
      preErr.style.color='#ff6b6b';
      preErr.textContent = stderrText;
      outEl.appendChild(preErr);
    }

  } catch(e){
    outEl.innerHTML = "<pre style='color:#ff6b6b'></pre>";
    outEl.querySelector('pre').textContent = (e && e.message) ? e.message : String(e);
  }
}
</script>

</main>
</body>
</html>
